<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>العملاء</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
    <link rel="stylesheet" href="./css/framework.css" />
    <link rel="stylesheet" href="./css/master.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&display=swap" rel="stylesheet" />

    <script src="./js cdn/circle1.js"></script>

    <link rel="icon" type="image/x-icon" href="./imgs/dashboard.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="./js cdn/momentCdn.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">


    


    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.2.8/es6-promise.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.min.js" ></script>


    <style>

      html{
        min-width: 1200px;
        overflow: scroll;
      }


      @font-face {
        font-family: myFirstFont;
        src: url(./Fonts/Ethnocentric.ttf);
      }

      
      /* Table Styles */

      .table-wrapper{
          box-shadow: 0px 35px 50px rgba( 0, 0, 0, 0.2 );
      }

      .fl-table {
          border-radius: 5px;
          font-size: 17px;
          font-weight: normal;
          border: none;
          border-collapse: collapse;
          width: 100%;
          max-width: 100%;
          white-space: nowrap;
          background-color: white;
      }

      .fl-table td{
          text-align: center;
          padding: 3px;
          border: 2px solid black;
      }


      .fl-table th {
          text-align: center;
          padding: 8px;
          border: 2px solid black;
      }


      .fl-table td {
          border-right: 1px solid #f8f8f8;
          font-size: 14px;
          font-family: 'Cairo';
      }


      .fl-table thead th {
          color: #ffffff;
          background: black;
      }

      .fl-table tr {
        border: 1px solid rgb(0, 0, 0);
      }

      /* Responsive */





      .CompanyName::before{
        content: "Digital vision for information technology";
        position: relative;
        bottom: -28px;
        left: 300px;
        font-family: myFirstFont;
        color: #397eaf;
        font-size: 13px;
      }




      .OrderActiveNote{
        width: 98%;
        border: 2px solid black;
        border-radius: 6px;
        padding: 10px;
        font-size: 20px;
      }


      .OrderActiveNoteTwo{
        width: 98%;
        border: 2px solid black;
        border-radius: 6px;
        padding: 10px;
        font-size: 20px;
      }








    </style>

  </head>
  <body>
    <div class="page d-flex">
      
      <div class="content w-full">
        
        <!-- Start Head -->
        <div class="head bg-white between-flex" style="padding: 0px 10px 15px; background: #f1f5f9;">
          <div class="p-relative">
            <h1 class="p-relative PageOrdersCountDad" style="text-align: center;">
              العملاء
              <span class="PageOrdersCount">0</span>
            </h1>
          </div>
        </div>
        <!-- End Head -->

        <div style="display: flex;align-items: center;justify-content: space-between; overflow: auto;">
          <div>
            <select class="limitToFirst">
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="500">500</option>
              <option value="1000">1000</option>
              <option value="2000">2000</option>
              <option value="10000">10000</option>
            </select>
          </div>


          <button class="mainClassForSetColor" style="min-width:200px;font-size: 18px; font-family:cairo; cursor:pointer; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 10px; font-weight: 600;">
            Total Price: 
            <span class="TotalPrice">0</span>
          </button>

          
          <button style="min-width:100px;font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 0px; font-weight: 600;" class="TheGoal mainClassForSetColor">
            الهدف
          </button>
          

          <button style="min-width:100px;font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 0px; font-weight: 600;" class="reports mainClassForSetColor">
            التقرير          
          </button>
        




          <div class="SearchDiv mainClassForSetColor" style="min-width:400px;background: #0a1951; border-radius: 6px; border: none; padding: 5px;">
            <select dir="rtl" class="SearchField" style="margin: 5px 0px;font-size: 20px;background: white;color: black;padding: 5px;border: 2px solid black;border-radius: 6px;text-align: start;font-weight: bold;">
              <option value="orderNumber">رقم الطلب</option>
              <option value="name">اسم العميل</option>
              <option value="orderByUser">اسم المندوب</option>
              <option value="phone">	رقم جوال العميل</option>
              <option value="city">	المدينة</option>
              <option value="price">المبلغ</option>
              <option value="active">الطلب</option>
              <option value="startTime">التاريخ</option>
            </select>
            <input type="text" dir="auto" placeholder="Search text" class="addOrderInput SearchInput" style="max-width: 150px; font-size: 20px;">
            <button class="SearchBtn" style="cursor: pointer; font-size: 20px;background: white;color: black;padding: 5px;border: 2px solid black;border-radius: 6px;text-align: end;font-weight: bold;">Search</button>
          </div>

          <button style="min-width:100px;font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 0px; font-weight: 600;" class="mainClassForSetColor" onclick="ExportData()">excel</button>

          <button style="min-width:100px;font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 0px; font-weight: 600; border: none;" class="addNewOrder mainClassForSetColor">اضافة عميل</button>
        </div>

        <div style="overflow: auto;">

          <div class="table-wrapper">
            <table class="fl-table">
                <thead class="mainClassForSetColor">
                <tr>
                    <th>التعديل</th>
                    <th>التاريخ</th>
                    <th>المبلغ</th>
                    <th>تفاصيل الطلب</th>
                    <th>الطلب</th>
                    <th>المدينة</th>
                    <th>رقم جوال العميل</th>
                    <th>اسم المندوب</th>
                    <th>اسم العميل</th>
                    <th>رقم الطلب</th>
                    <th>#</th>
                </tr>
                </thead>

                <tbody id="AllOrders">
                
                <tbody>
            </table>


            <!-- start load more div and btn -->
            <div style="display: flex;justify-content: center;padding: 10px 0px;">
              <button class="loadMoreBtn">Load More</button>
              <div class="loaderIcon" style="display: none;">
                <i style="font-size: 35px;padding: 5px; " class="fa-solid fa-spinner fa-spin"></i>
              </div>
            </div>
            <!-- end load more div and btn -->




        </div>
          
        </div>

      </div>


      <!-- Start Sidebar can copy it to anthor file -->
      <div class="sidebar bg-white p-20 p-relative">
        <div class="HelloDiv">

          <div style="display: flex; justify-content: center;">

            <input style="display: none;" id="personImgInput" type="file" name="img" accept="image/*">
            <label for="personImgInput" style="cursor: pointer;">
              <img style="width: 100px;" class="personImg" src="https://img.freepik.com/free-icon/user_318-159711.jpg" alt="">
            </label>

          </div>

          <h2>Hello <span id="AdminName" style="color: #397eaf"></span></h2>
        </div>
        <ul>
          
          <li class="AllPagesBtns">
           

          </li>
          <a class="Orders-Accepted active d-flex align-center fs-14 c-black rad-6 p-10" style="display: flex; justify-content: end; cursor: pointer; background: rgba(137, 8, 8, 0.676); color: white;" id="logOut-digital">
            <span style="font-weight: bold; font-size:20px;">تسجيل الخروج</span>
            <i class="fas fa-sign-out-alt fa-fw" style="font-weight: bold; font-size:20px; margin-left: 10px; color: white;"></i>
          </a>
          
        </ul>
      </div>
      <!-- End Sidebar can copy it to anthor file -->

    </div>
  </body>
  <script src="./js cdn/swalCdn.js"></script>

  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-database.js"></script>

  <script src="./AllPagesObject.js"></script>
  <script src="./js cdn/chart.js"></script>

  <script type="module">


  /**/
  import {docName, initializeApp,firebaseConfig, getFirestore,getCountFromServer, collection, query, where, getDocs,getDoc, setDoc, updateDoc, addDoc, doc,deleteDoc,onSnapshot,orderBy, limit,startAt,endAt } from './firebase.js';

  firebase.initializeApp(firebaseConfig);
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const storage = firebase.storage();
  /**/

  let X;

  async function getCit(db,X) {
  const citiesCol = collection(db,`${X}`);
  const citySnapshot = await getDocs(citiesCol);
  const cityList = citySnapshot.docs.map(doc => doc.data());
  return cityList;
  };








const isAccepted = true;










/* start return All Orders Accepted */

let AllOrders;

async function forAllOrders(X){

  const q = query(collection(db, "Persons"), where('isAccepted', '==', isAccepted), orderBy("date","desc"), limit(X||10));
  const querySnapshot = await getDocs(q);
  const cityList = querySnapshot.docs.map(doc => doc.data());

  AllOrders=cityList;

  return AllOrders;
};

/* end return All Orders Accepted */


//////////////////////////////////////////////////////////////////////////



/*start login cods*/



/* 02 start get AllAccounts */

async function getUserDataWithId(id){
  let userData;
  await getDoc(doc(db, "accounts", `${id}`)).then(e=>{
    userData=e.data();
  });
  return userData;
}


/* 02 end get All Accounts */



/* 04 start check and get user doc */

let mainPersonData;
let docId = await localStorage.getItem(`${docName}`);

if(docId!==null&&docId.trim()!==''){
    // document.querySelector('.profile-btn').dataset.personid=docId;
    // mainPersonData=await getUserDataWithId(docId);
    mainPersonData= JSON.parse(localStorage.getItem(`${docName}_personData`));

    if(mainPersonData.isAdmin==false){
      location.href="./Dashboard-notAdmin.html";
    };

    document.querySelector("#AdminName").textContent=`${mainPersonData.username}`;
    document.querySelector(".personImg").src=mainPersonData.personImg||"https://img.freepik.com/free-icon/user_318-159711.jpg"

   
    /* start getOrdersCount */

    let q = query(collection(db, "Persons"), where('isAccepted', '==', isAccepted));
    let snapshot = await getCountFromServer(q);
    document.querySelector(".PageOrdersCount").textContent=snapshot.data().count;
    getAllOrders();
    /* end getOrdersCount */


} else {
  location.href="./login/login.html"
}

/* 04 end check and get user doc */




/*end login cods*/










/* start img upload and show */



let personImgInput = document.querySelector("#personImgInput")
personImgInput.addEventListener("change",()=>{

  Swal.fire({
    title: 'Please Wait!',
    didOpen: () => {
      Swal.showLoading()
    }
  });



  let firebaseStorageUrl = document.querySelector('.personImg').src;
  let startIndex = firebaseStorageUrl.indexOf('o/') + 2;
  let endIndex = firebaseStorageUrl.indexOf('?alt=media');
  let filePathAndName = firebaseStorageUrl.substring(startIndex, endIndex);
  let fileName = decodeURIComponent(filePathAndName);


  let imageRef = storage.ref().child(fileName);
  // Delete the file
  imageRef.delete().then(function() {
    console.log("done")
  }).catch(function(error) {
    console.log("error")
  });






  let ref = firebase.storage().ref();
  let file = personImgInput.files[0];
  let name = +new Date() + "-" + file.name;
  let metadata = {
    contentType: file.type
  };

  let task = ref.child(name).put(file, metadata);
  task
  .then(async snapshot => snapshot.ref.getDownloadURL())
  .then(async url => {

    console.log(mainPersonData.id)

    updateDoc(doc(db, "accounts", `${mainPersonData.id}`), {
      personImg: url,
    }).then(e=>{
      Swal.fire("Done","","success")
      console.log(url);
      document.querySelector('.personImg').src=url;
      mainPersonData.personImg=url;
      localStorage.setItem(`${docName}_personData`,JSON.stringify(mainPersonData));
    })
    

  })
  .catch(console.error);


});


/* end img upload and show */













/* 2 start function to get differnce between data now */
function getDiffDate(oldDate){
        
    var starts = moment(`${oldDate}`);
    var ends   = moment();

    var duration = moment.duration(ends.diff(starts));

    // with ###moment precise date range plugin###
    // it will tell you the difference in human terms

    var diff = moment.preciseDiff(starts, ends, true); 
    // example: { "years": 2, "months": 7, "days": 0, "hours": 6, "minutes": 29, "seconds": 17, "firstDateWasLater":  false }


    // or as string:
    var diffHuman = moment.preciseDiff(starts, ends);
    // example: 2 years 7 months 6 hours 29 minutes 17 seconds

    let diffDate=diff;

    if(diffDate.years!==0){
        diffDate={
            "diffDateNum": diffDate.years,
            "diffDateName": "سنة",
        };
    } else if(diff.months!==0){
        diffDate={
            "diffDateNum": diffDate.months,
            "diffDateName": "شهر",
        };
    } else if(diff.days!==0){
        diffDate={
            "diffDateNum": diffDate.days,
            "diffDateName": "يوم",
        };
    } else if(diff.hours!==0){
        diffDate={
            "diffDateNum": diffDate.hours,
            "diffDateName": "ساعة",
        };
    } else if(diff.minutes!==0){
        diffDate={
            "diffDateNum": diffDate.minutes,
            "diffDateName": "دقيقة",
        };
    } else {
        diffDate={
            "diffDateNum": 0,
            "diffDateName": "الان",
        };
    }

    let stringDiffDate = `منذ ${diffDate.diffDateNum + " " + diffDate.diffDateName}`;
    // منذ 1 سنة

    if(diffDate.diffDateName=="الان"){
      stringDiffDate="الان";
    }
    
    // diffDate => json like {diffDateNum: 1, diffDateName: 'سنة'}

    return stringDiffDate;
}

// console.log(getDiffDate("2022/1/1 => 5:55 PM"));

/* 2 end function to get differnce between data now */






/* start limitToFirst btn */

document.querySelector(".limitToFirst").addEventListener("change",(e)=>{

let limitToFirst=e.srcElement.value;

getAllOrders(limitToFirst);
  
});

/* end limitToFirst btn */










/* 3 start get all Orders */
let AllPersonsData;



async function getAllOrders(X){
  
  forAllOrders(X).then(AllOrders=>{
    let i = 0;
  
    AllPersonsData=AllOrders;
  
    if(AllOrders.length!==0){
      document.querySelector("#AllOrders").innerHTML="";
      showData(AllOrders);
    }

    
  });

}


/* 3 End get all Orders */


























/* start search in firebase doc (search in students) */


document.querySelector(".SearchBtn").addEventListener("click",async ()=>{

let SearchField = document.querySelector(".SearchField").value;
let SearchInput = document.querySelector(".SearchInput").value;

SearchField=SearchField.trim();
SearchInput=SearchInput.trim();

// console.log(SearchField,SearchInput);

if(SearchField!==""&&SearchField!=="SearchInput"){

  const q = query(collection(db, "Persons"), where("isAccepted", '==', isAccepted), where(SearchField, '==', SearchInput), orderBy("date","desc"),limit(5));

  const querySnapshot = await getDocs(q);
  const cityList = querySnapshot.docs.map(doc => doc.data());
  let AllFromSearch=cityList;

  AllPersonsData=AllFromSearch;
  AllOrders=AllPersonsData;

  
  document.querySelector("#AllOrders").innerHTML=``;
  showData(AllFromSearch);


  document.querySelector(".loadMoreBtn").dataset.search=`${JSON.stringify({
    SearchField: SearchField,
    SearchInput: SearchInput
  })}`;

};

});


/* end search in firebase doc (search in students) */












async function showData(x){
  
  let TotalPrice=0;
  let i = 0;

  x.forEach(el=>{
    i++;
    TotalPrice+=Number(el.price);
    document.querySelector("#AllOrders").innerHTML+=`

    <tr data-id="${el.id}" style="font-weight: 600;">
      <td class="Order-Editing">
                      

        <a>
          <i title="حذف" class="fa-solid fa-trash removeOrder" data-id="${el.id}" style="font-size: 20px; color: white; background: darkred; border-radius: 50%; padding: 6px 8px; cursor: pointer;"></i>
        </a>

        <a>
          <i title="ارشيف" class="fa-solid fa-folder-open archiveOrder" data-id="${el.id}" style="font-size: 20px; color: white; background: gray; border-radius: 50%; padding: 7px 5px 5px 6px; cursor: pointer;"></i>
        </a>

        <a>
          <i title="تعديل" class="fa-solid fa-pen-to-square editOrder" data-id="${el.id}" style="font-size: 20px; color: #e0dfdf; background: #233245; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>

        <a href="http://wa.me/${el.country_calling_code+Number(el.phone)}" target="_blank">
          <i title="واتساب" class="fa-brands fa-whatsapp" style="font-size: 20px; color: white; background: green; border-radius: 50%; padding: 4px 5px; cursor: pointer;"></i>
        </a>

        

                      
      </td>
      <td class="Order-Date">${getDiffDate(el.orderDate)}</td>
      <!--
      <td class="Order-Status">${(moment.preciseDiff(moment(), moment(`${el.endTime}`),true).firstDateWasLater)?"منتهي":"نشط"}</td>
      <td class="Order-End">${(el.endTime==undefined)?0:el.endTime}</td>
      <td class="Order-Shape">${(el.shape==undefined)?moment.preciseDiff(moment(`${el.startTime}`), moment(`${el.endTime}`)):el.shape}</td>
      <td class="Order-Start">${(el.startTime==undefined)?0:el.startTime}</td>
      -->
      <td class="Order-Price">${(el.price==undefined)?0:el.price}</td>
      <td>
        <a>
          <i title="تفاصيل الطلب" class="fa-sharp fa-solid fa-circle-info Order-Note" data-id="${el.id}" data-note="${el.note}" style="font-size: 25px; color: #233245; background: white; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>
      </td>
      <td>

      <bdi class="Order-Active">
        ${(el.active=="Store")?`
        <a>
          <i title="سلة المنتجات" class="fa-sharp fa-solid fa-circle-info OrderFromStore" data-id="${el.id}" data-store='${JSON.stringify(el.dataStore)}' style="font-size: 25px; color: rebeccapurple; background: white; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>
        `:`${el.active}`}
      </bdi>

      </td>
      <td class="Order-City">${el.city}</td>
      <td class="Order-Phone">${el.phone}</td>
      <td class="Order-ByUser">${el.orderByUser}</td>
      <td>
        <bdi class="Order-Name">
          ${el.name}
        </bdi>
      </td>
      <td class="Order-Number">${el.orderNumber}</td>
      <td class="Order-Id">#${i}</td>
    </tr>
    
    `;

    document.querySelector(".TotalPrice").innerHTML=`${TotalPrice}`;

  });
}





/* start report section */



document.querySelector(".reports").addEventListener("click",()=>{

  Swal.fire({
      title: 'قم باختيار التاريخ',
      html: `
      
      <input type="date" id="DateStarts" min="2022-01-01" style="padding: 5px; font-size: 18px;" >
      <br><br>
      <input type="date" id="DateEnds" min="2022-01-01" style="padding: 5px; font-size: 18px;">
      
      `,
      confirmButtonText: 'عرض',
      showCancelButton: true
  }).then(async (e)=>{

    if(e.isConfirmed){

      let DateStarts = document.querySelector("#DateStarts").value;
      let DateEnds = document.querySelector("#DateEnds").value;
  
      DateStarts=DateStarts.trim();
      DateEnds=DateEnds.trim();
  
      DateStarts = new Date(DateStarts).getTime();
      DateEnds = new Date(DateEnds).getTime();
  
      const q = query(collection(db, "Persons"), where("isAccepted", "==", isAccepted), where("date", ">", DateStarts), where("date", "<", DateEnds), orderBy("date","desc"));
      const querySnapshot = await getDocs(q);
      const cityList = querySnapshot.docs.map(doc => doc.data());
  
      AllPersonsData=cityList;
      AllOrders=AllPersonsData;
  
      document.querySelector("#AllOrders").innerHTML=``;
      showData(cityList);
      document.querySelector(".loadMoreBtn").style.display="none";

    }
    

  });

});





/* end report section */




/* start TheGoal section*/


document.querySelector(".TheGoal").addEventListener("click",async ()=>{


  Swal.fire({
    title: 'Please Wait!',
    didOpen: () => {
      Swal.showLoading()
    }
  });

 






  let value = 0;
  let goal = 1000;



  let currentDate = new Date();
  currentDate.setDate(1);
  currentDate.setHours(0, 0, 0, 0);
  let DateStarts = currentDate.getTime();

  let DateEnds = Date.now();

  let q = query(collection(db, "Persons"), where("isAccepted", "==", isAccepted), where("date", ">", DateStarts), where("date", "<", DateEnds), orderBy("date","desc"));
  let querySnapshot = await getDocs(q);
  let OrdersLastMonth = querySnapshot.docs.map(doc => doc.data());

  let totalPrice=0;
  OrdersLastMonth.forEach(el=>{
    totalPrice+=parseInt(el.price);
  });
  let CountOrdersLastMonth=OrdersLastMonth.length;
  value = totalPrice;

  await getDoc(doc(db,"last-month","TheGoal")).then(e=>{
    // console.log(e.data().goal);
    if(e.data()!==undefined){
      goal=e.data().goal;
    };
  });


/* start get count last day and last weak */

/* start get time from lastSaturday*/

  let today = new Date();
  let dayOfWeek = today.getDay();
  let lastSaturday = new Date(today.getFullYear(), today.getMonth(), today.getDate() - (dayOfWeek + 1));
  lastSaturday=lastSaturday.getTime();

  let OrdersFromLastSaturday = OrdersLastMonth.filter(el=>el.date>=lastSaturday);
  let CountOrdersLastWeek=OrdersFromLastSaturday.length;
  

  let OrdersFromLastSaturdayTotalPrice = 0;

  OrdersFromLastSaturday.forEach(e=>{
    OrdersFromLastSaturdayTotalPrice+=parseInt(e.price);
  });

  console.log(OrdersFromLastSaturdayTotalPrice);
  console.log(CountOrdersLastWeek);
  

/* end get time from lastSaturday*/


/* start get time FromStartOfDay*/
  let FromStartOfDay= new Date().setHours(0, 0, 0, 0); // from day  start not last 24 hour


  let OrdersFromStartOfDay = OrdersLastMonth.filter(el=>el.date>=FromStartOfDay);
  let CountOrdersLastDay = OrdersFromStartOfDay.length;

  let OrdersFromStartOfDayTotalPrice = 0;

  OrdersFromStartOfDay.forEach(e=>{
    OrdersFromStartOfDayTotalPrice+=parseInt(e.price);
  });

  // console.log(OrdersFromStartOfDayTotalPrice);
  // console.log(CountOrdersLastDay);

/* end get time FromStartOfDay*/


/* end get count last day and last weak */

let DateNow = new Date;
let thisMonthDate = `${DateNow.getFullYear()}-${DateNow.getMonth()+1}`;

setDoc(doc(db,"last-months",`${thisMonthDate}`),{
  CountOrdersThisMonth: CountOrdersLastMonth,
  totalPrice: totalPrice,
  goal: goal,
  thisMonthDate: thisMonthDate,
  date: Date.now()
}).then(e=>{
  // console("تم تحديث وحفظ بيانات هذا الشهر في قاعدة البيانات ضمن الاشهر السابقة")
})

  

  

Swal.fire({
    title: ``,
    html: `
    <h1>${Math.round((value*100)/goal)}%  هدف الشهر</h1>
    <div class="progress"></div>

    <hr>

    <div>

      <div class="PageOrdersCountDad" style="margin: 10px 0px; text-align: center; display: flex; justify-content: space-between;">

        <div>
          المجموع
          <span class="PageOrdersCount">${OrdersFromStartOfDayTotalPrice}</span>
        </div>

        <div>
          عدد العملاء اليوم 
          <span class="PageOrdersCount">${CountOrdersLastDay}</span>
        </div>

      </div>

      <div class="PageOrdersCountDad" style="margin: 10px 0px; text-align: center; display: flex; justify-content: space-between;">

        <div>
          المجموع
          <span class="PageOrdersCount">${OrdersFromLastSaturdayTotalPrice}</span>
        </div>

        <div>
          عدد العملاء هذا الاسبوع
          <span class="PageOrdersCount">${CountOrdersLastWeek}</span>
        </div>

      </div>

      <div class="PageOrdersCountDad" style="margin: 10px 0px; text-align: center; display: flex; justify-content: space-between;">

        <div>
          المجموع
          <span class="PageOrdersCount">${totalPrice}</span>
        </div>

        <div>
          عدد العملاء هذا الشهر
          <span class="PageOrdersCount">${CountOrdersLastMonth}</span>
        </div>

      </div>

      <button class="showAllLastMonths mainClassForSetColor">
        
        عرض الاشهر السابقة
        
      </button>

      
    </div>
    `,
    showCloseButton: true,
    showConfirmButton: false
});


const cp = new CircleProgress('.progress', {
  value: value,
  max: goal,
});

document.querySelector(".circle-progress-text").innerHTML=`${value}/${goal}`;
document.querySelector(".circle-progress-text").dataset.goal=goal;
document.querySelector(".circle-progress-text").style=`
fill: black;
font-size: 14px;
font-weight: bold;
padding: 10px;
`;
document.querySelector(".circle-progress").style.height="200px";
document.querySelector(".circle-progress").style.width="100%";


});


/* end TheGoal section */








/* 4 Start set Orders Accepted and orders archived*/

window.onclick=async(e)=>{


/* start showAllLastMonths btn*/

if([...e.target.classList].includes("showAllLastMonths")){

  let q = query(collection(db, "last-months"), orderBy("date","desc"));
  let querySnapshot = await getDocs(q);
  let AllLastMonths = querySnapshot.docs.map(doc => doc.data());

  console.log(AllLastMonths);

  let AllMonthsDate=[];
  let AllMonthsTotalPrice=[];
  let AllMonthsGoals=[];
  let CountOrdersThisMonth=[];


  let htmlElement = document.createElement("div")

  AllLastMonths.forEach(e=>{

    AllMonthsDate.push(e.thisMonthDate);
    AllMonthsTotalPrice.push(e.totalPrice);
    AllMonthsGoals.push(e.goal);
    CountOrdersThisMonth.push(e.CountOrdersThisMonth);

    htmlElement.innerHTML+=`
    
    <div class="PageOrdersCountDad" style="margin: 10px 0px; text-align: center; display: flex; justify-content: space-between;">
      
      <div>
        <span class="PageOrdersCount">${e.CountOrdersThisMonth}</span>
      </div>

      <div>
        <span class="PageOrdersCount">${e.totalPrice}</span>
      </div>

      <div>
        <span class="PageOrdersCount">${e.thisMonthDate}</span>
      </div>

    </div>
    
    `;
  })
  

Swal.fire({
    title: ``,
    html: `

    <div>
      <canvas id="myChart1"></canvas>
    </div>


    <hr>


    <div>
      <canvas id="myChart2"></canvas>
    </div>

    <div style="margin: 10px 0px; display: none;">

      <div class="PageOrdersCountDad" style="margin: 10px 0px; text-align: center; display: flex; justify-content: space-between;">

        <div>
          العملاء
        </div>

        <div>
          المجموع
        </div>

        <div>
          تاريخ الشهر
        </div>

      </div>

      <hr>

      ${htmlElement.innerHTML}


    </div>
    `,
    showCloseButton: true,
    showConfirmButton: false
});


let TotalOrders = 0;
let TotalPrices = 0;
AllLastMonths.forEach(el=>{
  TotalOrders+=Number(el.CountOrdersThisMonth);
  TotalPrices+=Number(el.totalPrice);
});

let ctx1 = document.getElementById('myChart1');

new Chart(ctx1, {
  type: 'bar',
  data: {
    labels: AllMonthsDate,
    datasets: [
    {
      label: 'Month TotalPrice',
      data: AllMonthsTotalPrice,
      borderWidth: 2,
      borderColor: '#ff9f40',
      backgroundColor: '#ffcd5696',
    },
    {
      label: 'Month Goal',
      data: AllMonthsGoals,
      borderWidth: 2,
      borderColor: 'green',
      backgroundColor: '#00800069',
    },
  ]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true
      }
    },
    plugins: {
      title: {
        display: true,
        text: `Total Prices: ${TotalPrices}`,
        color: 'black',
        font: {
          size: 18,
          family: 'cairo',
          weight: 'bold',
        },
      },
      tooltip: {
        usePointStyle: true,
      }
    },
  }
});



let ctx2 = document.getElementById('myChart2');



new Chart(ctx2, {
  type: 'bar',
  data: {
    labels: AllMonthsDate,
    datasets: [
    {
      label: 'Month Count Orders',
      data: CountOrdersThisMonth,
      borderWidth: 2,
      // borderColor: 'black',
      // backgroundColor: '#000000ab',
    }
  ]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true,
        // suggestedMax: 200
      },
    },
    plugins: {
      title: {
        display: true,
        text: `Total Orders: ${TotalOrders}`,
        color: 'black',
        font: {
          size: 18,
          family: 'cairo',
          weight: 'bold',
        },
      },
      tooltip: {
        usePointStyle: true,
      }
    },
  },
});



}

/* end showAllLastMonths btn*/
  


/* start loadMoreBtn btn*/

if([...e.target.classList].includes("loadMoreBtn")){

e.target.style.display="none";
document.querySelector(".loaderIcon").style.display="block";


let lastElementDate=AllPersonsData[AllPersonsData.length-1].date;
let q;

if(e.target.dataset.search!==undefined){

  let search = JSON.parse(e.target.dataset.search);
  q = query(collection(db, "Persons"),where(search.SearchField,"==",search.SearchInput), where('isAccepted', '==', isAccepted),where("date","<",lastElementDate), orderBy("date","desc"), limit(X||5));

} else{
  q = query(collection(db, "Persons"), where('isAccepted', '==', isAccepted),where("date","<",lastElementDate), orderBy("date","desc"), limit(X||5));
}

let querySnapshot = await getDocs(q);
let cityList = querySnapshot.docs.map(doc => doc.data());
let AllElementFromLoadMore=cityList;

AllPersonsData=[...AllPersonsData,...AllElementFromLoadMore];
AllOrders=AllPersonsData;


document.querySelector("#AllOrders").innerHTML=``;
await showData(AllPersonsData);

e.target.style.display="block";
document.querySelector(".loaderIcon").style.display="none";

};



/* end loadMoreBtn btn*/





if([...e.target.classList].includes("saveSala")){
  

  let div = document.querySelector("#swal2-html-container > div")
  document.querySelector(".saveSala").style.opacity="0"

  html2canvas(div, {
    allowTaint: false,
    useCORS: true,
  }).then((canvas) => {
    const dataImg = new Image();
    var link = document.createElement('a');
    link.download = `  `;
    link.href = canvas.toDataURL('image/png', 1.0);
    link.click();
    document.querySelector(".saveSala").style.opacity="100"
  });


}


  if([...e.target.classList].includes("circle-progress-text")){

     let goal = document.querySelector(".circle-progress-text").dataset.goal;
    Swal.fire({
      title: 'ادخل هدف الشهر',
      html: `
      
      <input style="padding: 10px;font-size: 25px;font-weight: bold;border-radius: 10px;" id="goal" type="number" value=${goal}>
      
      `,
      confirmButtonText: 'Ok',
      showCancelButton: true
    }).then(e=>{

      if(e.isConfirmed){

        let goal = document.querySelector("#goal").value;
        
        if(Number(goal)!==0){
          setDoc(doc(db,"last-month","TheGoal"),{
            goal: goal,
          }).then(e=>{
            Swal.fire({
              title: 'تم تعيين هدف الشهر',
              icon: "success"
            })
          })
  
        }

      }


      
    })
    
  }







/* start order detals btn*/
if([...e.target.classList].includes("OrderFromStore")){


  
let orderData = AllOrders.find(order => order.id === e.target.dataset.id)


let arrayOfProducts = JSON.parse(e.target.dataset.store);
console.log(arrayOfProducts);
const div = document.createElement("div");
let totalPrice=0;
div.innerHTML=`

<div style="
display: flex;
justify-content: space-around; 
font-family: 'cairo'; 
font-size: 15px;">
<h2 style="order: 2;">
  اسم العميل 
  : ${orderData.name}
</h2>

<h2>
  رقم الهاتف
  : 
  <span style="font-size: 25px;">${orderData.phone}</span>
</h2>
</div>

<hr>

<div class="shopping-cart">
  
  <div class="column-labels">
    <label class="product-image">صورة المنتج</label>
    <label class="product-details">اسم المنتج</label>
    <label class="product-price">السعر</label>
    <label class="product-quantity">الكمية</label>
    <label class="product-line-price">الاجمالي</label>
  </div>
  
</div>`;

arrayOfProducts.forEach(e=>{
  totalPrice+=Number(e.productPrice)*Number(e.productAmount);
  div.innerHTML+=`
  
  <div class="product" >
    <div class="product-image">
      <img src="${e.productImage}">
    </div>
    <div class="product-details">
      <div class="product-title" style="font-family: 'cairo'">${e.productName}</div>
    </div>
    <div class="product-price">${e.productPrice}</div>
    <div class="product-quantity">
      ${e.productAmount}
    </div>
    <div class="product-line-price">${Number(e.productPrice)*Number(e.productAmount)}</div>
  </div>

  `;
});

div.innerHTML+=`
<p style="font-family: 'cairo'">
  
  اجمالي السعر 
  ${totalPrice}
  جنية
  
</p>
<button class="saveSala">Save</button>
`

Swal.fire({
  html: div,
  width: "800px",
  confirmButtonText: 'ok',
  showCloseButton: true,
  showConfirmButton: false,
})

}
/* end order detals btn*/



























/* start order detals btn*/
if([...e.target.classList].includes("Order-Note")){

let orderId=e.target.dataset.id;
let orderData=AllPersonsData.find(el=>el.id==`${orderId}`);
console.log(orderData.orderDate)
Swal.fire({
  html:`
  <div style="display: flex;justify-content: space-around; font-family: 'cairo'; font-size: 15px;">
    <h2 style="order: 2; margin: 10px 0;">
      ${orderData.name}
    </h2>

    <h2 style="margin: 10px 0;">
      <span style="font-size: 25px;">${orderData.phone}</span>
    </h2>
  </div>

  <hr>

  <h2 style="margin: 5px 0px; font-family: cairo;">
    <bdi>
      ${orderData.active}
    </bdi>
  </h2>

  <hr>

  <h2 style="margin: 30px 0px; font-family: cairo;">
    <bdi>
      ${e.target.dataset.note}
    </bdi>
  </h2>

  <hr>

  <p style="color: white;background: var(--main-bg);padding: 10px;border-radius: 10px;font-weight: 400;">
    ${orderData.orderDate}
  </p>

  
  `,
  showCancelButton: false,
  showConfirmButton: false,
  showCloseButton: true
});
}
/* end order detals btn*/



/* start accept order */

if([...e.target.classList].includes("acceptOrder")){

Swal.fire({
title: 'Are you Want To Accept It?',
text: "",
icon: 'warning',
showCancelButton: true,
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: 'Yes, Accept it!'
}).then((result) => {
  if (result.isConfirmed) {

    let orderId=e.target.dataset.id;
    let orderData=AllPersonsData.find(el=>el.id==`${orderId}`);

    updateDoc(doc(db,"Persons",orderId),{
      isAccepted: true,
    });

    e.target.parentNode.parentNode.parentNode.remove();

    AllOrders = AllOrders.filter(obj => obj.id !== orderId);
    AllPersonsData = AllPersonsData.filter(obj => obj.id !== orderId);

    Swal.fire(
      'Accepted!',
      'Your Order has been Accepted.',
      'success'
    );

  }
})

};
/* end accept order */





/* start archive order */
if([...e.target.classList].includes("archiveOrder")){

  Swal.fire({
  title: 'Are you Want To Archive It?',
  text: "",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, Archive it!'
  }).then((result) => {
    if (result.isConfirmed) {

      let orderId=e.target.dataset.id;
      let orderData=AllPersonsData.find(el=>el.id==`${orderId}`);

      updateDoc(doc(db,"Persons",orderId),{
        isAccepted: false,
      });

      e.target.parentNode.parentNode.parentNode.remove();

      AllOrders = AllOrders.filter(obj => obj.id !== orderId);
      AllPersonsData = AllPersonsData.filter(obj => obj.id !== orderId);

      Swal.fire(
        'Archived!',
        'Your Order has been Archived.',
        'success'
      );

    }
  })

};
/* end archive order */






/* start remove order */
if([...e.target.classList].includes("removeOrder")){


  Swal.fire({
  title: 'Are you want to delet it?',
  text: "You won't be able to revert this!",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
    if (result.isConfirmed) {

      let orderId=e.target.dataset.id;
      let orderData=AllPersonsData.find(el=>el.id==`${orderId}`);

      let orderDoc=doc(db, "Persons", orderId);

      deleteDoc(orderDoc);

      e.target.parentNode.parentNode.parentNode.remove();

      AllOrders = AllOrders.filter(obj => obj.id !== orderId);
      AllPersonsData = AllPersonsData.filter(obj => obj.id !== orderId);

      Swal.fire(
        'Deleted!',
        'Your order has been deleted.',
        'success'
      );

    }
  })


};
/* end remove order */




/* start edit order */


if([...e.target.classList].includes("editOrder")){

  let orderId=e.target.dataset.id;
  let orderData=AllPersonsData.find(el=>el.id==`${orderId}`);

  swool(orderData);

};



function swool(orderData){

  
  Swal.fire({
      title: 'قم بتعديل البيانات التالية',
      html: `
      
      
      <div class="mainForm" style="overflow-y: hidden; overflow-c: scroll; font-size: 17px!important; font-family: 'Cairo', sans-serif; font-weight: bold!important;">

          <label for="name">:الاسم</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="auto" autocomplete="off" id="name" value="${orderData.name}">

          <label for="phone">رقم الجوال:</label>
          <input style="width: 98%;" class="addOrderInput" type="number" placeholder="" dir="auto" autocomplete="off" id="phone" value="${orderData.phone}">

          <label for="active">الطلب:</label>
          ${(orderData.active=="Store")?`
          <input style="width: 98%;" class="addOrderInput" id="active" type="text" dir="auto" autocomplete="off" readonly value="${orderData.active}">
          `:`<input style="width: 98%;" class="addOrderInput" id="active" type="text" dir="auto" autocomplete="off" value="${orderData.active}">
          `}

          
          <label for="price">الملاحظة:</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="note" value="${(orderData.note==undefined)?"":orderData.note}">
           
          <label for="city">المدينة:</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="city" value="${orderData.city}">

          <label for="price">المبلغ:</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="price" value="${(orderData.price==undefined)?0:orderData.price}">

      </div>
      
      
      `,
      confirmButtonText: 'حفظ',
  }).then((result) => {    
      if (result.isConfirmed) {

          let name=document.querySelector("#name").value;
          let phone=document.querySelector("#phone").value;
          let active=document.querySelector("#active").value;
          let note=document.querySelector("#note").value;
          let city=document.querySelector("#city").value;
          let price=document.querySelector("#price").value;



          SetData(name,phone,active,city,price);

          function SetData(name,phone,active,city,price){
            updateDoc(doc(db,"Persons",orderData.id), {
              name: name,
              phone: phone,
              city: city,
              active: active,
              price: price,
              note: note,
              isAccepted: (orderData.isAccepted==undefined)?'':orderData.isAccepted,
            }).then(async (e)=>{
              let mainEditedDiv = document.querySelector(`[data-id="${orderData.id}"]`)
              mainEditedDiv.querySelector(".Order-Name").textContent=name;
              mainEditedDiv.querySelector(".Order-Phone").textContent=phone;
              mainEditedDiv.querySelector(".Order-City").textContent=city;
              mainEditedDiv.querySelector(".Order-Active").textContent=active;
              mainEditedDiv.querySelector(".Order-Price").textContent=price;
              mainEditedDiv.querySelector(".Order-Note").dataset.note=note;


              let mainOrderFromAll = AllPersonsData.find(el=>el.id==`${orderData.id}`);
              mainOrderFromAll.name=name;
              mainOrderFromAll.price=price;
              mainOrderFromAll.phone=phone;
              mainOrderFromAll.city=city;
              mainOrderFromAll.active=active;
              mainOrderFromAll.note=note;
             

              Swal.fire(' تم التعديل ', '', 'success');
            })

          };
          
      };
  });

};

/* end edit order */


};

/* 4 end set Orders Accepted and orders archived*/











/* 5 start add new order */

document.querySelector(".addNewOrder").addEventListener("click",()=>{


  Swal.fire({
      title: ' اضافة عميل جديد ',
      html: `
      
      
      <div class="mainForm" style="overflow-y: hidden; overflow-c: scroll; font-size: 17px!important; font-family: 'Cairo', sans-serif; font-weight: bold!important;">

          <label for="name">:الاسم</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="auto" autocomplete="off" id="name" value="">

          <label for="phone">رقم الهاتف:</label>
          <input style="width: 98%;" class="addOrderInput" type="number" placeholder="" dir="auto" autocomplete="off" id="phone" value="">

          <label for="active">الطلب:</label>
          <input style="width: 98%;" class="addOrderInput" id="active" type="text" dir="auto" autocomplete="off">

          <label for="price">المبلغ:</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="price" value="">

          <label for="note">الملاحظة:</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="note" value="">

          <label for="city">المحافظة/العنوان</label>
          <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="city" value="">

          


      </div>
      
      
      `,
      confirmButtonText: 'اضافة',
  }).then((result) => {    
      if (result.isConfirmed) {

          let name=document.querySelector("#name").value;
          let phone=document.querySelector("#phone").value;
          let active=document.querySelector("#active").value;
          let city=document.querySelector("#city").value;
          let price=document.querySelector("#price").value;
          let note=document.querySelector("#note").value;


          function idGenerator() {
            var S4 = function() {
              return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
            };
            return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
          };

          let id = idGenerator();
          if(name.trim()!==""&&phone.trim()!==""&&active.trim()!==""&&city.trim()!==""){
            AddNewOrder(name,phone,active,city,price,id);
          } else {
            Swal.fire(
                'برجاة كتابة البيانات بشكل صحيح',
                '',
                'error',
              )
          }

          function AddNewOrder(name,phone,active,city,price,id){
            let randomOrderNumber = (Math.random()*1000000).toFixed();
            setDoc(doc(db,"Persons",id), {
              id: id,
              name: name,
              phone: phone,
              city: city,
              active: active,
              price: price,
              note: note,
              country_calling_code: "+20",
              date: Date.now(),
              isAccepted: isAccepted,
              orderDate: showDate(),
              orderByUser: mainPersonData.username,
              orderNumber: randomOrderNumber,
            }).then(e=>{
           
              Swal.fire(
                'تم الاضافة بنجاح',
                '',
                'success',
              )

            });

          };
          
      };
  });

});


/* 5 end add new order */






/* 1 start function to get data now */
function showDate(){
  
  const d = new Date();
  
  let year = d.getFullYear();
  let month = d.getMonth();
  let day = d.getDate();
  let hour = d.getHours();
  let mint = d.getMinutes();
  
  if(mint<10){
    mint=`0${mint}`
  }
  
  let dateNow;

  console.log(hour)

  if (hour>=12){
    
    dateNow= `
      ${year}/${month+1}/${day}
      => ${hour-12}:${mint} PM
      `;

  } else if (hour<=11){
    
      dateNow = `
      
      ${year}/${month+1}/${day}
         ${hour}:${mint} AM
      
      `;
  }
  return dateNow;
}

/* 1 end function to get data now */














const colRef= collection(db,"Persons");




onSnapshot(colRef,async ()=>{

  let q = query(collection(db, "Persons"), where('isAccepted', '==', isAccepted), where('date', '>', (AllOrders[0]!==undefined)?AllOrders[0].date:0), orderBy("date","desc"), limit(X||10));
  let querySnapshot = await getDocs(q);
  let cityList = querySnapshot.docs.map(doc => doc.data());

  if(cityList.length!==0){
    (AllOrders[0]!==undefined)?AllOrders[0].date=cityList[0].date:"";
    
    cityList.forEach(ee=>{
      AllPersonsData.push(ee);
    });
    document.querySelector("#AllOrders").innerHTML="";
    AllPersonsData.sort((a, b) => a.date - b.date).reverse();
    showData(AllPersonsData);
  }


});



</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.1/xlsx.full.min.js"></script> 
<script>
  function ExportData()
  {
      let filename='reports.xlsx';

      let AA=[]; 
      let arrayOfNames = [...document.querySelectorAll(".Order-Name")];
      let arrayOfPhones = [...document.querySelectorAll(".Order-Phone")];
      let arrayOfCitys = [...document.querySelectorAll(".Order-City")];
      let arrayOfOrderActives = [...document.querySelectorAll(".Order-Active")];
      let arrayOfOrderPrices = [...document.querySelectorAll(".Order-Price")];
      let arrayOfOrderNumbers= [...document.querySelectorAll(".Order-Number")];
      // let arrayOfCitys = [...document.querySelectorAll(".Order-City")];

      for (let i=0; i<arrayOfNames.length; i++){
        
        AA.push(
          {
            phone: arrayOfPhones[i].textContent, 
            name: arrayOfNames[i].textContent, 
            city: arrayOfCitys[i].textContent,
            OrderActive: (arrayOfOrderActives[i].querySelector("a")===null)?`${arrayOfOrderActives[i].textContent.trim()}`:`بعض المنتجات من المتجر`,
            OrderPrice: arrayOfOrderPrices[i].textContent,
            OrderNumber: arrayOfOrderNumbers[i].textContent,
          }
        );
      }

      let data = AA;
      console.log(data);

      let DataWitoutPhonesRepeat = [];


      for(let i=0; i<data.length; i++){

        if(!DataWitoutPhonesRepeat.find(e=>e.phone==data[i].phone)){
          DataWitoutPhonesRepeat.push(data[i])
        }

      };

      console.log(DataWitoutPhonesRepeat);


      const worksheet = XLSX.utils.json_to_sheet(DataWitoutPhonesRepeat);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, "Dates");
      XLSX.writeFile(workbook,filename);
   }
</script>

</html>
