
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard-Store</title>

    <!-- css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
    <link rel="stylesheet" href="./css/framework.css" />
    <link rel="stylesheet" href="./css/master.css" />
    <link rel="stylesheet" href="./css/dashboard.css" />
    <!-- css -->

    <!-- swiper css -->
    <link rel="stylesheet" href="./js cdn/swiper.min.css">
    <!-- swiper css -->



    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- fonts -->

    <!-- page icon -->
    <link rel="icon" type="image/x-icon" href="./imgs/dashboard.png">
    <!-- page icon -->

    <!-- cdn moment js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="./js cdn/momentCdn.js"></script>
    <!-- cdn moment js -->

  </head>

  <body>

    <div class="page d-flex">
      

      <!-- main section -->
      <div class="content w-full">
        
        <!-- Start Head -->
        <div class="head bg-white between-flex" style="padding: 0px 10px 15px; background: #f1f5f9;">
          <div class="p-relative">
            <h1 class="p-relative PageOrdersCountDad" style="text-align: center;">
              المنتجات
              <span class="PageOrdersCount">0</span>
            </h1>
          </div>
          <div class="icons d-flex align-center">
            <a href="./index.html" title="ذهاب للمتجر">
              <i class="fa-solid fa-store" style="color: black; font-size: 30px; margin: 18px 0px 0px;"></i>
            </a>
          </div>
        </div>
        <!-- End Head -->

        <div style="display: flex;align-items: center; justify-content: space-between; margin: 10px 5px; overflow: scroll;">
          <div>
            <select class="limitToFirst">
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="500">500</option>
              <option value="1000">1000</option>
              <option value="2000">2000</option>
              <option value="10000">10000</option>
            </select>
          </div>

          <div class="SearchDiv mainClassForSetColor" style="background: #0a1951; border-radius: 6px; border: none; padding: 5px;">
            <select dir="rtl" class="SearchField" style="margin: 5px 0px;font-size: 20px;background: white;color: black;padding: 5px;border: 2px solid black;border-radius: 6px;text-align: start;font-weight: bold;">
              <option value="id">رقم المنتج</option>
              <option value="ProductName">اسم المنتج</option>
              <option value="ProductPrice"> سعر المنتج </option>
              <option value="ProductCategorieName"> القسم </option>
            </select>
            <input type="text" dir="auto" placeholder="Search text" class="addOrderInput SearchInput" style="max-width: 150px; font-size: 20px;">
            <button class="SearchBtn" style="cursor: pointer; font-size: 20px;background: white;color: black;padding: 5px;border: 2px solid black;border-radius: 6px;text-align: end;font-weight: bold;">Search</button>
          </div>

          <button style="font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 0px; font-weight: 600; border: none; min-width: 120px;" class="BannarBtn mainClassForSetColor">تعديل البانر</button>
          <button style="font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 0px; font-weight: 600; border: none; min-width: 120px;" class="StoreCategoriesBtn mainClassForSetColor">اقسام المتجر</button>
          <button style="font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: #0a1951; color: white; padding: 5px 0px; font-weight: 600; border: none; min-width: 120px;" class="addNewOrder mainClassForSetColor">اضافة منتج</button>
        </div>

        <div style="overflow: auto;">

          <div class="table-wrapper">
            <table class="fl-table">
                <thead class="mainClassForSetColor">
                <tr>
                    <th>التعديل</th>
                    <th>القسم</th>
                    <th>سعر المنتج</th>
                    <th>اسم المنتج</th>
                    <th>رقم المنتج</th>
                    <th>#</th>
                </tr>
                </thead>

                <tbody id="AllOrders">
                
                </tbody>
            </table>

            <!-- start load more div and btn -->
            <div style="display: flex;justify-content: center;padding: 10px 0px;">
              <button class="loadMoreBtn">Load More</button>
              <div class="loaderIcon" style="display: none;">
                <i style="font-size: 35px;padding: 5px; " class="fa-solid fa-spinner fa-spin"></i>
              </div>
            </div>
            <!-- end load more div and btn -->

        </div>
          
        </div>

      </div>
      <!-- main section -->

      <!-- Sidebar -->
      <div class="sidebar bg-white p-20 p-relative">
        <div class="HelloDiv">

          <div style="display: flex; justify-content: center;">

            <input style="display: none;" id="personImgInput" type="file" name="img" accept="image/*">
            <label for="personImgInput" style="cursor: pointer;">
              <img style="width: 100px;" class="personImg" src="https://img.freepik.com/free-icon/user_318-159711.jpg" alt="">
            </label>

          </div>

          <h2>Hello <span id="AdminName" style="color: #397eaf"></span></h2>
        </div>
        <ul>
          
          <li class="AllPagesBtns">
           

          </li>
          <a class="Orders-Accepted active d-flex align-center fs-14 c-black rad-6 p-10" style="display: flex; justify-content: end; cursor: pointer; background: rgba(137, 8, 8, 0.676); color: white;" id="logOut-digital">
            <span style="font-weight: bold; font-size:20px;">تسجيل الخروج</span>
            <i class="fas fa-sign-out-alt fa-fw" style="font-weight: bold; font-size:20px; margin-left: 10px; color: white;"></i>
          </a>
          
        </ul>
      </div>
      <!-- Sidebar -->

    </div>

  </body>
  
  <!-- swal -->
  <script src="./js cdn/swalCdn.js"></script>
  <!-- swal -->

  <!-- firebase  -->
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-database.js"></script>
  <!-- firebase  -->

  <!-- All dashboard Pages js file  -->
  <script src="./AllPagesObject.js"></script>
  <!-- All dashboard Pages js file  -->


  <!-- Swiper -->
  <script src="./js cdn/swiper.min.js"></script>
  <!-- Swiper -->



<script type="module">

/* start import from firebase */

  import {docName, initializeApp,firebaseConfig ,getFirestore,getCountFromServer, collection, query, where, getDocs,getDoc, setDoc, addDoc, updateDoc, doc,deleteDoc,onSnapshot,orderBy, limit,startAt,endAt } from './firebase.js';

  firebase.initializeApp(firebaseConfig);
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const storage = firebase.storage();
  /**/

  let X;

  async function getCit(db,X) {
  const citiesCol = collection(db,`${X}`);
  const citySnapshot = await getDocs(citiesCol);
  const cityList = citySnapshot.docs.map(doc => doc.data());
  return cityList;
  };

/* end import from firebase */








/* start return AllStoreProducts */

let AllStoreProducts;

async function forAllStoreProducts(X){

  const q = query(collection(db, "StoreProducts"), orderBy("date","desc"), limit(X||10));
  const querySnapshot = await getDocs(q);
  const cityList = querySnapshot.docs.map(doc => doc.data());

  AllStoreProducts=cityList;

  return AllStoreProducts;
};

/* end return AllStoreProducts */


//////////////////////////////////////////////////////////////////////////










/*start login cods*/




/*  start check and get user doc */
let AllPersonsData;
let mainPersonData;
let docId = await localStorage.getItem(`${docName}`);

if(docId!==null&&docId.trim()!==''){
    // document.querySelector('.profile-btn').dataset.personid=docId;
    // mainPersonData=await getUserDataWithId(docId);
    mainPersonData= JSON.parse(localStorage.getItem(`${docName}_personData`));

    if(mainPersonData.isAdmin==false){
      location.href="./Dashboard-notAdmin.html";
    };

    document.querySelector("#AdminName").textContent=`${mainPersonData.username}`;
    document.querySelector(".personImg").src=mainPersonData.personImg||"https://img.freepik.com/free-icon/user_318-159711.jpg"


    const colRef= collection(db,"StoreProducts");

    // onSnapshot(colRef,async()=>{
    //   getAllStoreProducts(document.querySelector("#AllOrders").children.length);
    // });
    getAllStoreProducts();
    /* start getOrdersCount */

    let q = query(collection(db, "StoreProducts"));
    let snapshot = await getCountFromServer(q);
    document.querySelector(".PageOrdersCount").textContent=`${snapshot.data().count}`;

    /* end getOrdersCount */


} else {
  location.href="./login/login.html"
}

/*  end check and get user doc */





/*  start get AllAccounts */

async function getUserDataWithId(id){
  let userData;
  await getDoc(doc(db, "accounts", `${id}`)).then(e=>{
    userData=e.data();
  });
  return userData;
}

/*  end get All Accounts */

/*end login cods*/










/* start img upload and show */

let personImgInput = document.querySelector("#personImgInput")
personImgInput.addEventListener("change",()=>{

  Swal.fire({
    title: 'Please Wait!',
    didOpen: () => {
      Swal.showLoading()
    }
  });



  let firebaseStorageUrl = document.querySelector('.personImg').src;
  let startIndex = firebaseStorageUrl.indexOf('o/') + 2;
  let endIndex = firebaseStorageUrl.indexOf('?alt=media');
  let filePathAndName = firebaseStorageUrl.substring(startIndex, endIndex);
  let fileName = decodeURIComponent(filePathAndName);


  let imageRef = storage.ref().child(fileName);
  // Delete the file
  imageRef.delete().then(function() {
    console.log("done")
  }).catch(function(error) {
    console.log("error")
  });


  let ref = firebase.storage().ref();
  let file = personImgInput.files[0];
  let name = +new Date() + "-" + file.name;
  let metadata = {
    contentType: file.type
  };

  let task = ref.child(name).put(file, metadata);
  task
  .then(async snapshot => snapshot.ref.getDownloadURL())
  .then(async url => {

    console.log(mainPersonData.id)

    setDoc(doc(db, "accounts", `${mainPersonData.id}`), {
      ...mainPersonData,
      personImg: url,
    }).then(e=>{
      Swal.fire("Done","","success")
      console.log(url);
      document.querySelector('.personImg').src=url;
      mainPersonData.personImg=url;
      localStorage.setItem(`${docName}_personData`,JSON.stringify(mainPersonData));
    })
    

  })
  .catch(console.error);


});


/* end img upload and show */









/* start limitToFirst btn */

document.querySelector(".limitToFirst").addEventListener("change",(e)=>{

let limitToFirst=e.srcElement.value;

getAllStoreProducts(limitToFirst);
  
});

/* end limitToFirst btn */










/*  start get AllStoreProducts */

async function getAllStoreProducts(X){
  
  forAllStoreProducts(X).then(AllStoreProducts=>{
    let i = 0;
  
    AllPersonsData=AllStoreProducts;
  
    if(AllStoreProducts.length!==0){
      document.querySelector("#AllOrders").innerHTML="";
    }

    showProducts(AllStoreProducts);

  });

};


/*  End get AllStoreProducts */








/* start search in firebase doc (search in students) */


document.querySelector(".SearchBtn").addEventListener("click",async ()=>{

let SearchField = document.querySelector(".SearchField").value;
let SearchInput = document.querySelector(".SearchInput").value;

SearchField=SearchField.trim();
SearchInput=SearchInput.trim();

// console.log(SearchField,SearchInput);

if(SearchField!==""&&SearchField!=="SearchInput"){

  const q = query(collection(db, "StoreProducts"), where(SearchField, '==', SearchInput), orderBy("date","desc"),limit(5));

  const querySnapshot = await getDocs(q);
  const cityList = querySnapshot.docs.map(doc => doc.data());
  let AllFromSearch=cityList;

  // console.log(AllFromSearch);
  document.querySelector("#AllOrders").innerHTML=``;

  AllPersonsData=AllFromSearch;
  showProducts(AllFromSearch);


  document.querySelector(".loadMoreBtn").dataset.search=`${JSON.stringify({
    SearchField: SearchField,
    SearchInput: SearchInput
  })}`;

  
};

});


/* end search in firebase doc (search in students) */






/* start show products function */

function showProducts(array){
  let i = 0;

  array.forEach(el=>{
    i++;

    document.querySelector("#AllOrders").innerHTML+=`

    <tr data-id="${el.id}" style="font-weight: 600;">
      <td class="Order-Editing">
                      

        <a>
          <i title="حذف" class="fa-solid fa-trash removeOrder" data-id="${el.id}" style="font-size: 20px; color: white; background: darkred; border-radius: 50%; padding: 6px 8px; cursor: pointer;"></i>
        </a>

        <a>
          <i title="تعديل" class="fa-solid fa-list choicesOrder" data-id="${el.id}" style="font-size: 20px; color: #e0dfdf; background: #233245; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>

        <a>
          <i title="تعديل" class="fa-solid fa-pen-to-square editOrder" data-id="${el.id}" style="font-size: 20px; color: #e0dfdf; background: #233245; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>

        <a>
          <i title="تفاصيل المنتج" class="fa-sharp fa-solid fa-circle-info Order-Note" data-id="${el.id}" data-img="${el.ArrayOfProductImages[0].src||el.ProductImage}" data-note="${el.ProductNote}" style="font-size: 25px; color: #233245; background: white; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>

        <a>
          <i title="الملفات" class="fa-sharp fa-solid fa-file Order-file" data-id="${el.id}" data-file='${(el.ArrayOfOrderFilesLinks==undefined)?'[]':JSON.stringify(el.ArrayOfOrderFilesLinks)}' style="font-size: 25px; color: #233245; background: white; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>

        <a>
          <i title="اخفاء/اظهار المنتج" class="fa-sharp fa-solid ${el.isHidden==true?`fa-eye-slash`:`fa-eye`} Product-Hidden" data-id="${el.id}" style="font-size: 25px; color: #233245; background: white; border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>

        <a href="./index.html?product=${el.id}" target="_blank">
          <i title=" نسخ لينك المنتج  " class="fa-solid fa-paperclip" data-id="${el.id}" style="font-size: 22px; color: white; background: var(--main-bg); border-radius: 50%; padding: 5px 5px; cursor: pointer;"></i>
        </a>

                      
      </td>
      <td class="Product-Categorie-Name">${el.ProductCategorieName}</td>
      <td class="Product-Price">${el.ProductPrice}</td>
      <td>
        <bdi class="Product-Name">
          ${el.ProductName}
        </bdi>
      </td>
      <td class="Product-Number">${el.id}</td>
      <td class="Product-Id">#${i}</td>
    </tr>
    
    `;
  });
};

/* end show products function */








/*//////////////////////////////////////////////////////////////////*/

window.onclick=async(e)=>{



/* start loadMoreBtn btn*/

if([...e.target.classList].includes("loadMoreBtn")){

  e.target.style.display="none";
  document.querySelector(".loaderIcon").style.display="block";


  let lastElementDate=AllPersonsData[AllPersonsData.length-1].date;
  let q;

  if(e.target.dataset.search!==undefined){

    let search = JSON.parse(e.target.dataset.search);
    q = query(collection(db, "StoreProducts"),where(search.SearchField,"==",search.SearchInput),where("date","<",lastElementDate), orderBy("date","desc"), limit(X||5));
  
  } else{

    q = query(collection(db, "StoreProducts"),where("date","<",lastElementDate), orderBy("date","desc"), limit(X||5));
  
  }

  let querySnapshot = await getDocs(q);
  let cityList = querySnapshot.docs.map(doc => doc.data());
  let AllStoreProductsFromLoadMore=cityList;

  AllPersonsData=[...AllPersonsData,...AllStoreProductsFromLoadMore];

  document.querySelector("#AllOrders").innerHTML=``;
  await showProducts(AllPersonsData);
  
  e.target.style.display="block";
  document.querySelector(".loaderIcon").style.display="none";
};



/* end loadMoreBtn btn*/





/* start Product-Hidden btn*/

if([...e.target.classList].includes("Product-Hidden")){


  let icon = e.target;

  let productId=e.target.dataset.id;
  let productData=AllPersonsData.find(el=>el.id==`${productId}`);

  // console.log(productData)
  let title = `هل تريد ${productData.isHidden==true?"اظهار":"اخفاء"} هذا المنتج؟`;

  Swal.fire({
  title: `${title}`,
  text: "",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes'
  }).then((result) => {
    if (result.isConfirmed) {

      Swal.fire({
        title: 'Please Wait!',
        didOpen: () => {
          Swal.showLoading()
        }
      });

      let x = (productData.isHidden==true?false:true);




      updateDoc(doc(db,"StoreProducts",productId),{
        isHidden: x,
      }).then(e=>{

        productData.isHidden=x;
  
        if(x){
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        }else{
          icon.classList.add("fa-eye");
          icon.classList.remove("fa-eye-slash");
        }

        Swal.fire(
          'Done!',
          '',
          'success'
        );

      });


    };
  });


};

/* end Product-Hidden btn*/








/* start remove file btn*/
if([...e.target.classList].includes("removeFile")){

  Swal.fire({
  title: 'هل تريد حذف هذا الملف؟',
  text: "",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes'
  }).then((result) => {
    if (result.isConfirmed) {

      let productId=e.target.dataset.orderid;
      let productData=AllPersonsData.find(el=>el.id==`${productId}`);
      let ArrayOfProductImages=productData.ArrayOfProductImages;
      ArrayOfProductImages = ArrayOfProductImages.filter(obj => obj.src !== e.target.dataset.filesrc);

      let firebaseStorageUrl = e.target.dataset.filesrc
      let startIndex = firebaseStorageUrl.indexOf('o/') + 2;
      let endIndex = firebaseStorageUrl.indexOf('?alt=media');
      let filePathAndName = firebaseStorageUrl.substring(startIndex, endIndex);
      let fileName = decodeURIComponent(filePathAndName);


      var imageRef = storage.ref().child(fileName);
      // Delete the file
      imageRef.delete().then(function() {
        console.log("done")
      }).catch(function(error) {
        console.log("error")
      });

      updateDoc(doc(db,"StoreProducts",productId),{
        ArrayOfProductImages: ArrayOfProductImages,
      });

      productData.ArrayOfProductImages=ArrayOfProductImages;

      Swal.fire(
        'Done!',
        'تم حذف الملف',
        'success'
      );

    }
  })

};

/* end remove file btn*/



  



/* start btn to show all product imgs */

if([...e.target.classList].includes("Order-file")){

  let productId=e.target.dataset.id;
  let productData=AllPersonsData.find(el=>el.id==`${productId}`);
  // console.log(productData)

  let ArrayOfProductImages;
  if(productData.ArrayOfProductImages==undefined){
    ArrayOfProductImages=[]
  } else {
    ArrayOfProductImages=productData.ArrayOfProductImages;
  }
  

  // console.log(ArrayOfProductImages)


  let div = document.createElement("div")
  

  for(let i=0; i<ArrayOfProductImages.length; i++){

    if(productData.ProductImage==ArrayOfProductImages[i].src){
      div.innerHTML+=`
      <div style="display: flex;justify-content: space-around;align-items: center; margin: 15px; ">

        <i data-orderid="${productId}" data-filesrc="${ArrayOfProductImages[i].src}" title="This Is The Main Product Img" class="fa-solid fa-panorama makeThisImgTheMainProductImg" style="color: #a21616; font-size: 30px;  cursor: auto;"></i>

        <div style="width: 300px; height: 300px;">
          <img class="simpleShadow" style=" max-width: 100%;height: 100%;border-radius: 10px;" src="${ArrayOfProductImages[i].src}">
        </div>
        
        <i data-orderid="${productId}" data-filesrc="${ArrayOfProductImages[i].src}" class="removeFile fa-regular fa-trash fa-fw" ></i>
      </div>
      `;
    }else{

      div.innerHTML+=`

      
      <div style="display: flex;justify-content: space-around;align-items: center; margin: 15px; ">

        <i data-orderid="${productId}" data-filesrc="${ArrayOfProductImages[i].src}" title="make This Img The Main Product Img" class="fa-solid fa-panorama makeThisImgTheMainProductImg" style="color: #c4c4c4; font-size: 30px; cursor: pointer;"></i>
        
        <div style="width: 300px; height: 300px;">
          <img class="simpleShadow" style=" max-width: 100%;height: 100%;border-radius: 10px;" src="${ArrayOfProductImages[i].src}">
        </div>
        
        <i data-orderid="${productId}" data-filesrc="${ArrayOfProductImages[i].src}" class="removeFile fa-regular fa-trash fa-fw" ></i>
      </div>
      `;

    };


  };
  
  
  Swal.fire({
    title: ' جميع صور المنتج',
    html: div,
    confirmButtonText: 'Ok',
  })

};

/* end btn to show all product imgs */





  
/* start btn to make Main ProductImg BTN */
if([...e.target.classList].includes("makeThisImgTheMainProductImg")){
  let productId=e.target.dataset.orderid;
  let productData=AllPersonsData.find(el=>el.id==`${productId}`);

  let mainImgSrc = e.target.dataset.filesrc;

  // console.log(productData)

  e.target.classList.add("fa-spinner");

  updateDoc(doc(db,"StoreProducts",productData.id), {
    ProductImage: mainImgSrc,
  }).then(()=>{

    productData.ProductImage=mainImgSrc;
    document.querySelectorAll(".makeThisImgTheMainProductImg").forEach(el=>{
      el.title="make This Img The Main Product Img";
      el.style.color="#c4c4c4";
    });
    e.target.style.cursor="auto";
    e.target.style.color="#a21616";
    e.target.title="This Is The Main Product Img";
    e.target.style.cursor="pointer";
    e.target.classList.remove("fa-spinner");
    
    console.log("Done");

  })



};
/* end btn to make Main ProductImg BTN */







/* start btn to  add Categorie */
if([...e.target.classList].includes("AddNewCategorie")){
  AddNewCategorie();
};
/* end btn to  add Categorie */






  
/* start btn to  Delete Categorie */
if([...e.target.classList].includes("RemoveCategorie")){
  DeleteCategorie();
};
/* start btn to  Delete Categorie */







/* start order detals btn*/
if([...e.target.classList].includes("Order-Note")){

  let productId=e.target.dataset.id;
  let productData=AllPersonsData.find(el=>el.id==`${productId}`);
  console.log(productData)



    Swal.fire({
      html: `


      <pre style="text-align: center;font-size: 30px;font-weight: bold;font-family: cairo;">${productData.ProductName} سعر البيع ${productData.ProductPrice} جنية</pre>

      <div class="swiperDivForProductPageSlider" style="width: 100% !important; margin: 0 auto; z-index: 0;">
        <div class="swiper swiper-productNoteBtn simpleShadow" style="border-radius: 15px; margin: 20px 5px;">
        
          <div class="swiper-wrapper swiper-wrapper-productNoteBtn dadOfImages">

          </div>
        
          <div class="swiper-pagination swiper-pagination-productNoteBtn"></div>
          <div style="display: none;" class="swiper-button-prev swiper-button-prev-productNoteBtn"></div>
          <div style="display: none;" class="swiper-button-next swiper-button-next-productNoteBtn"></div>
          <div class="swiper-scrollbar swiper-scrollbar-productNoteBtn"></div>

        </div>
      </div>


      <textarea readonly dir="auto" style="border-radius: 5px; min-height: 250px; cursor: auto; width: 100%;padding: 10px;font-size: 25px; font-weight: bold; border: 2px solid #00000096;">
        ${e.target.dataset.note}
      </textarea>`,

    });


    if(productData.ArrayOfProductImages!==undefined){

      for(let i=0; i<productData.ArrayOfProductImages.length; i++){


        let htmlDiv = `

        <div class="swiper-slide" style="width: 100% !important; border-radius: 15px;">
          <img style="width: 100%; border-radius: 15px; padding: 5px;" loading="lazy" src="${productData.ArrayOfProductImages[i].src}">
        </div>

        `;

        document.querySelector(".swiper-wrapper-productNoteBtn").insertAdjacentHTML("beforeend", htmlDiv);

      };

    } else {

      let htmlDiv = `

      <div class="swiper-slide" style="width: 100% !important; border-radius: 15px;">
        <img style="width: 100%; border-radius: 15px; padding: 5px;" loading="lazy" src="${productData.ProductImage}">
      </div>

      `;

      document.querySelector(".swiper-wrapper-productNoteBtn").insertAdjacentHTML("beforeend", htmlDiv);

    };


    new Swiper('.swiper-productNoteBtn', {
      // Optional parameters
      autoplay: {
        delay: 3000,
      },
      direction: 'horizontal',
      loop: true,


      // pagination: {
      //   el: '.swiper-pagination-productNoteBtn',
      // },


      navigation: {
        nextEl: '.swiper-button-next-productNoteBtn',
        prevEl: '.swiper-button-prev-productNoteBtn',
      },

      scrollbar: {
        el: '.swiper-scrollbar-productNoteBtn',
      },
    });

};
/* end order detals btn*/


/* start choicesOrder btn*/
if([...e.target.classList].includes("choicesOrder")){

  let productId=e.target.dataset.id;
  let productData=AllPersonsData.find(el=>el.id==`${productId}`);
  console.log(productData)

  let choicesHtml1=document.createElement("div");
  let choicesHtml2=document.createElement("div");
  let choicesHtml3=document.createElement("div");

  if(productData.productOrderChoices!==undefined){

    for(let i=0; i<6; i++){
  
      choicesHtml1.innerHTML+=`
      <input dir="auto" class="Choice" type="text" name="" value="${(productData.productOrderChoices[0]!==undefined)?(productData.productOrderChoices[0].choices[i]!==undefined)?productData.productOrderChoices[0].choices[i]:"":""}">
      `;
      choicesHtml2.innerHTML+=`
      <input dir="auto" class="Choice" type="text" name="" value="${(productData.productOrderChoices[1]!==undefined)?(productData.productOrderChoices[1].choices[i]!==undefined)?productData.productOrderChoices[1].choices[i]:"":""}">
      `;
      choicesHtml3.innerHTML+=`
      <input dir="auto" class="Choice" type="text" name="" value="${(productData.productOrderChoices[2]!==undefined)?(productData.productOrderChoices[2].choices[i]!==undefined)?productData.productOrderChoices[2].choices[i]:"":""}">
      `;
  
    };

  }else{

    for(let i=0; i<6; i++){
  
      choicesHtml1.innerHTML+=`
      <input dir="auto" class="Choice" type="text" name="">
      `;
      choicesHtml2.innerHTML+=`
      <input dir="auto" class="Choice" type="text" name="">
      `;
      choicesHtml3.innerHTML+=`
      <input dir="auto" class="Choice" type="text" name="">
      `;

    };

  }


    Swal.fire({
      title: `<h1 style="font-family: cairo;font-size: 26px;margin: 0 !important;padding: 5px;background: var(--main-bg);border-radius: 20px;color: white;">خيارات المنتج</h1>`,
      html: `

          <div class="choicesOrderDiv" style="font-family: cairo;">

            <div class="OrderChoice1">
              <div>
                
                <div style="display: none; justify-content: space-between;">
                  <h5 class="questionNumber" style="margin: 20px 0px; font-size: 18px">(1)</h5>
                  <span>
                    <i title="حذف" class="fa-solid fa-trash remove" data-question="" style="font-size: 20px; color: white; background: darkred; border-radius: 50%; padding: 6px 8px; cursor: pointer;"></i>
                  </span>
                </div>

                <label>اسم الاختيار</label>
                <input dir="auto" class="ChoiceName" type="text" value="${(productData.productOrderChoices!==undefined&&productData.productOrderChoices[0]!==undefined)?productData.productOrderChoices[0].name:""}">
                
              </div>
              
              <label style="margin: 10px 0px;">الخيارات</label>
              <div style="display: flex; justify-content: center;">
                <div>

                  ${choicesHtml1.innerHTML}

                
                </div>
              </div>
              <hr>
            </div>

            <div class="OrderChoice2">
              <div>
                
                <div style="display: none; justify-content: space-between;">
                  <h5 class="questionNumber" style="margin: 20px 0px; font-size: 18px">(1)</h5>
                  <span>
                    <i title="حذف" class="fa-solid fa-trash remove" data-question="" style="font-size: 20px; color: white; background: darkred; border-radius: 50%; padding: 6px 8px; cursor: pointer;"></i>
                  </span>
                </div>

                <label>اسم الاختيار</label>
                <input dir="auto" class="ChoiceName" type="text" name="" value="${(productData.productOrderChoices!==undefined&&productData.productOrderChoices[1]!==undefined)?productData.productOrderChoices[1].name:""}">
                
              </div>
              
              <label style="margin: 10px 0px;">الخيارات</label>
              <div style="display: flex; justify-content: center;">
                <div>
                  
                  ${choicesHtml2.innerHTML}
                
                </div>
              </div>
              <hr>
            </div>

            <div class="OrderChoice3">
              <div>
                
                <div style="display: none; justify-content: space-between;">
                  <h5 class="questionNumber" style="margin: 20px 0px; font-size: 18px">(1)</h5>
                  <span>
                    <i title="حذف" class="fa-solid fa-trash remove" data-question="" style="font-size: 20px; color: white; background: darkred; border-radius: 50%; padding: 6px 8px; cursor: pointer;"></i>
                  </span>
                </div>

                <label>اسم الاختيار</label>
                <input dir="auto" class="ChoiceName" type="text" name="" value="${(productData.productOrderChoices!==undefined&&productData.productOrderChoices[2]!==undefined)?productData.productOrderChoices[2].name:""}">
                
              </div>
              
              <label style="margin: 10px 0px;">الخيارات</label>
              <div style="display: flex; justify-content: center;">
                <div>
                  
                  ${choicesHtml3.innerHTML}
                
                </div>
              </div>
              <hr>
            </div>

          </div>

      `,
      confirmButtonText: "Save"
    }).then(e=>{
      if(e.isConfirmed){


        
        let OrderChoice1 = document.querySelector(".OrderChoice1");
        let OrderChoice2 = document.querySelector(".OrderChoice2");
        let OrderChoice3 = document.querySelector(".OrderChoice3");

        let OrderChoice1Name = OrderChoice1.querySelector(".ChoiceName").value;
        let OrderChoice2Name = OrderChoice2.querySelector(".ChoiceName").value;
        let OrderChoice3Name = OrderChoice3.querySelector(".ChoiceName").value;


        let OrderChoice1Choices = OrderChoice1.querySelectorAll(".Choice");
        let OrderChoice1ChoicesValue=[];
        OrderChoice1Choices.forEach(e=>{
          if(e.value.trim()!==""){
            OrderChoice1ChoicesValue.push(e.value.trim());
          };
        });

        let OrderChoice2Choices = OrderChoice2.querySelectorAll(".Choice");
        let OrderChoice2ChoicesValue=[];
        OrderChoice2Choices.forEach(e=>{
          if(e.value.trim()!==""){
            OrderChoice2ChoicesValue.push(e.value.trim());
          };
        });

        let OrderChoice3Choices = OrderChoice3.querySelectorAll(".Choice");
        let OrderChoice3ChoicesValue=[];
        OrderChoice3Choices.forEach(e=>{
          if(e.value.trim()!==""){
            OrderChoice3ChoicesValue.push(e.value.trim());
          };
        });


        let productOrderChoices = [
          {
            name: OrderChoice1Name,
            choices: OrderChoice1ChoicesValue
          },
          {
            name: OrderChoice2Name,
            choices: OrderChoice2ChoicesValue
          },
          {
            name: OrderChoice3Name,
            choices: OrderChoice3ChoicesValue
          },
        ];

        productOrderChoices = productOrderChoices.filter(e=>e.name.trim()!=="");

        console.log(productOrderChoices);


        Swal.fire({
          title: 'Please Wait!',
          didOpen: () => {
            Swal.showLoading()
          }
        });



        updateDoc(doc(db,"StoreProducts",productData.id), {
          productOrderChoices: productOrderChoices,
        }).then(e=>{

          productData.productOrderChoices=productOrderChoices;
          console.log(productData);

        }).then(e=>{
          Swal.fire("Done","","success")
        })

        
      };
    });


}
/* end choicesOrder btn*/





/* start remove product */
if([...e.target.classList].includes("removeOrder")){


  Swal.fire({
  title: 'Are you want to delet it?',
  text: "You won't be able to revert this!",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
    if (result.isConfirmed) {

      let productId=e.target.dataset.id;
      let productData=AllPersonsData.find(el=>el.id==`${productId}`);

      let productDoc=doc(db, "StoreProducts", productId);

      deleteDoc(productDoc); 

      AllPersonsData=AllPersonsData.filter(el=>el.id!==`${productId}`);
      document.querySelector("#AllOrders").innerHTML=``;
      showProducts(AllPersonsData);
      Swal.fire(
        'Deleted!',
        'Product has been deleted.',
        'success'
      );

    }
  })


};

/* end remove product */







/* start edit product */

if([...e.target.classList].includes("editOrder")){

  let productId=e.target.dataset.id;
  let productData=AllPersonsData.find(el=>el.id==`${productId}`);

  swool(productData);

};



async function swool(productData){

  let AllStoreCategories;
  await getAllStoreCategories().then(e=>{
    AllStoreCategories=e;
  });


  let newSelect = document.createElement("select");
  AllStoreCategories.forEach(e=>{

    newSelect.innerHTML+=`
    <option value="${e.id}">${e.name}</option>
    `;

  });




  Swal.fire({
      title: 'قم بتعديل البيانات التالية',
      html: `
      
      
      <div class="mainForm" style="overflow-y: hidden; overflow-c: scroll; font-size: 17px!important; font-family: 'Cairo', sans-serif; font-weight: bold!important;">

        <label for="ProductName">اسم المنتج</label>
        <input style="width: 98%;" class="addOrderInput" type="text" dir="auto" autocomplete="off" id="ProductName" value="${productData.ProductName}">


        <label for="ProductPriceBeforeRival">سعر المنتج قبل الخصم</label>
        <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="ProductPriceBeforeRival" value="${productData.ProductPriceBeforeRival==undefined?"":productData.ProductPriceBeforeRival}">


        <label for="ProductPrice">سعر المنتج</label>
        <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="ProductPrice" value="${productData.ProductPrice}">

        <label for="ProductNote">وصف المنتج</label>
        <textarea style="width: 98%;" class="addOrderInput" rows="5" id="ProductNote" type="text" dir="auto" autocomplete="off"  value="${productData.ProductNote}">${productData.ProductNote}</textarea>


        <label for="ProductCategorie">القسم</label>
        <select style="width: 98%;" class="addOrderInput" id="ProductCategorie" dir="auto">
          <option value="${productData.ProductCategorieId}">${productData.ProductCategorieName}</option>
          ${newSelect.innerHTML}
        </select>


        <label for="ProductNote2">ملاحظات المنتج</label>
        <textarea style="width: 98%; max-height: 100px;" class="addOrderInput" rows="5" id="ProductNote2" type="text" dir="auto" autocomplete="off" value="${productData.ProductNote2==undefined?"":productData.ProductNote2}">${productData.ProductNote2==undefined?"":productData.ProductNote2}</textarea>
        <p style="color: #ff000099;">ملاحظات المنتج تظهر لي الادمن فقط</p>
        
   

        <label for="ProductImgInput" class="ProductImgLabel" style="border: none;border-radius: 20px;background: green;color: white;padding: 5px 15px;cursor: pointer;">اختر صور المنتج</label>
        <input style="width: 98%; display: none;" class="addOrderInput" accept="image/*" type="file" dir="rtl" autocomplete="off" id="ProductImgInput" multiple="multiple">

        <br><br>


        <div class="ProductImgsUploadDad" style="background: black; display: none; overflow:scroll; max-height: 250px; border: 2px solid black; border-radius: 6px; padding: 5px;">
        

        <p style="text-align: center;">
          Product Code ${productData.id}
        </p>


      </div>
      
      
      `,
      confirmButtonText: 'حفظ',
  }).then((result) => {    
      if (result.isConfirmed) {

          
            let ProductName=document.querySelector("#ProductName").value;
            let ProductPriceBeforeRival=document.querySelector("#ProductPriceBeforeRival").value;
            let ProductPrice=document.querySelector("#ProductPrice").value;
            let ProductNote=document.querySelector("#ProductNote").value;
            let ProductNote2=document.querySelector("#ProductNote2").value;
            let ProductImgInput = document.querySelector("#ProductImgInput");
            let ProductCategorieSelect=document.querySelector("#ProductCategorie");
            let ProductCategorieId=ProductCategorieSelect.value;
            let ProductCategorieName = ProductCategorieSelect.options[ProductCategorieSelect.selectedIndex].text;

            let id = productData.id;

            if(ProductName.trim()!==''&&ProductPrice.trim()!==''&&ProductNote.trim()!==''&&ProductCategorieId.trim()!==''&&ProductCategorieName.trim()!==''){


              if(ProductImgInput.files[0]==undefined){

                updateDoc(doc(db,"StoreProducts",productData.id), {
                  ProductName: ProductName,
                  ProductPriceBeforeRival: ProductPriceBeforeRival.trim()==""?"":ProductPriceBeforeRival,
                  ProductPrice: ProductPrice,
                  ProductNote: ProductNote,
                  ProductNote2: ProductNote2,
                  ProductCategorieId: ProductCategorieId,
                  ProductCategorieName: `${ProductCategorieName}`,
                }).then(e=>{

                  let mainEditedDiv = document.querySelector(`[data-id="${productData.id}"]`)
                  mainEditedDiv.querySelector(".Product-Name").textContent=ProductName;
                  mainEditedDiv.querySelector(".Product-Price").textContent=ProductPrice;
                  mainEditedDiv.querySelector(".Product-Categorie-Name").textContent=ProductCategorieName;
                  mainEditedDiv.querySelector(".Order-Note").dataset.note=ProductNote;

                  
                  let mainOrderFromAll = AllPersonsData.find(el=>el.id==`${productData.id}`);
                  mainOrderFromAll.ProductName=ProductName;
                  mainOrderFromAll.ProductPriceBeforeRival=ProductPriceBeforeRival;
                  mainOrderFromAll.ProductPrice=ProductPrice;
                  mainOrderFromAll.ProductNote=ProductNote;
                  mainOrderFromAll.ProductNote2=ProductNote2;
                  mainOrderFromAll.ProductCategorieId=ProductCategorieId;
                  mainOrderFromAll.ProductCategorieName=ProductCategorieName;
             

                  Swal.fire(
                    'تم التعديل',
                    '',
                    'success'
                  );

                });

              } else {

                Swal.fire({
                  title: 'Please Wait!',
                  didOpen: () => {
                    Swal.showLoading()
                  }
                });
                uploadImageForEditProduct(ProductImgInput,ProductName,ProductPrice,ProductNote,ProductNote2,id, undefined,ProductCategorieId,ProductCategorieName,productData.ProductDate,productData.date,productData.ArrayOfProductImages,ProductPriceBeforeRival);
              }

            };
      };
  });

};

/* end edit product */










/* start btn to upload img  */

if([...e.target.classList].includes("ProductImgLabel")){

  let imgInput = e.target.parentNode.querySelector("#ProductImgInput");
  let img = e.target.parentNode.querySelector(".ProductImgUpload");

  if(imgInput==null){
    imgInput=e.target.parentNode.querySelector("#BannerImgInput");

    imgInput.addEventListener("change",(e)=>{

      let x = imgInput.files[0];
      const reader = new FileReader();
      reader.readAsDataURL(imgInput.files[0]);
      reader.onload = () => {
        document.querySelector(".ProductImgUpload").style.display="block"
        document.querySelector(".ProductImgUpload").src=reader.result
      };

    })

  } else if(imgInput!==null)
  {
    
  imgInput.addEventListener("change",(e)=>{

    document.querySelector(".ProductImgsUploadDad").innerHTML=``;
    for(let i=0; i<e.target.files.length; i++){
      let x = e.target.files[i];
      const reader = new FileReader();
      reader.readAsDataURL(e.target.files[i]);
      reader.onload = () => {
        document.querySelector(".ProductImgsUploadDad").innerHTML+=`
        
          <img src="${reader.result}" style="border-radius: 10px; margin: 10px auto; max-height: 200px; border-bottom: 3px solid black; margin-bottom: 10px;" class="ProductImgUpload">

        `;
      };
    };

    // e.target.value=null;
    document.querySelector(".ProductImgLabel").style.display="none";
    document.querySelector(".ProductImgsUploadDad").style.display="block";
    });
    
  }

};

/* end btn to upload img  */



};








/*  start add new Product */

document.querySelector(".addNewOrder").addEventListener("click",async ()=>{


  let AllStoreCategories;
  await getAllStoreCategories().then(e=>{
    AllStoreCategories=e;
  });


  let newSelect = document.createElement("select");
  AllStoreCategories.forEach(e=>{

    newSelect.innerHTML+=`
    <option value="${e.id}">${e.name}</option>
    `;

  });


  Swal.fire({
      title: ' اضافة منتج جديد ',
      html: `
      
      
      <div class="mainForm" style="overflow-y: hidden; overflow-c: scroll; font-size: 17px!important; font-family: 'Cairo', sans-serif; font-weight: bold!important;">

        <label for="ProductName">اسم المنتج</label>
        <input style="width: 98%;" class="addOrderInput" type="text" dir="auto" autocomplete="off" id="ProductName" >

        <label for="ProductPrice">سعر المنتج</label>
        <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="ProductPrice">

        <label for="ProductNote">وصف المنتج</label>
        <textarea style="width: 98%;" class="addOrderInput" rows="5" id="ProductNote" type="text" dir="auto" autocomplete="off" id="ProductNote"></textarea>
      

        <label for="ProductCategorie">القسم</label>
        <select style="width: 98%;" class="addOrderInput" id="ProductCategorie" dir="auto">
          ${newSelect.innerHTML}
        </select>

        <br><br>

        <label for="ProductImgInput" class="ProductImgLabel" style="border: none;border-radius: 20px;background: green;color: white;padding: 5px 15px;cursor: pointer;">اختر صور المنتج</label>
        <input style="width: 98%; display: none;" class="addOrderInput" accept="image/*" type="file" dir="rtl" autocomplete="off" id="ProductImgInput" multiple="multiple">

        <br><br>

        <div class="ProductImgsUploadDad" style="background: black; display: none; overflow:scroll; max-height: 250px; border: 2px solid black; border-radius: 6px; padding: 5px;">
          
        </div>

      `,
      confirmButtonText: 'اضافة',
      showCancelButton: true,
  }).then(async (result) => {    
      if (result.isConfirmed) {
          let ProductName=document.querySelector("#ProductName").value;
          let ProductPrice=document.querySelector("#ProductPrice").value;
          let ProductNote=document.querySelector("#ProductNote").value;
          let ProductImgInput = document.querySelector("#ProductImgInput");
          let ProductCategorieSelect=document.querySelector("#ProductCategorie");
          let ProductCategorieId=ProductCategorieSelect.value;
          let ProductCategorieName = ProductCategorieSelect.options[ProductCategorieSelect.selectedIndex].text;

          function idGenerator() {
            return (Math.random()*10000000).toFixed();
          };

          let id = idGenerator();


          if(ProductName.trim()!==''&&ProductPrice.trim()!==''&&ProductNote.trim()!==''&&ProductCategorieId.trim()!==''&&ProductCategorieName.trim()!==''){
            Swal.fire({
              title: 'Please Wait!',
              didOpen: () => {
                Swal.showLoading()
              }
            });
            uploadImageForAddNewProduct(ProductImgInput,ProductName,ProductPrice,ProductNote,id, undefined,ProductCategorieId,ProductCategorieName);
          };

      };
  });

});


/* end add new Product */




/* start function to AddNewProduct */

function AddNewProduct(ProductName,ProductPrice,ProductNote,id,ProductImage,ProductCategorieId,ProductCategorieName,ArrayOfProductImages){
  setDoc(doc(db,"StoreProducts",id), {
      id: id,
      ProductName: ProductName,
      ProductPriceBeforeRival: "",
      ProductPrice: ProductPrice,
      ProductNote: ProductNote,
      ProductCategorieId: ProductCategorieId,
      ProductCategorieName: `${ProductCategorieName}`,
      ProductImage: ProductImage,
      ProductDate: showDate(),
      date: Date.now(),
      ArrayOfProductImages: ArrayOfProductImages,
      isHidden: false,
    }).then(e=>{


      AllPersonsData=[{
        id: id,
        ProductName: ProductName,
        ProductPriceBeforeRival: "",
        ProductPrice: ProductPrice,
        ProductNote: ProductNote,
        ProductCategorieId: ProductCategorieId,
        ProductCategorieName: `${ProductCategorieName}`,
        ProductImage: ProductImage,
        ProductDate: showDate(),
        date: Date.now(),
        ArrayOfProductImages: ArrayOfProductImages,
        isHidden: false,
      },...AllPersonsData];

      document.querySelector("#AllOrders").innerHTML=``;
      showProducts(AllPersonsData)


    });

};


/* end function to AddNewProduct */




/*  start function to editProduct */

function editProduct(ProductName,ProductPrice,ProductNote,ProductNote2,id,ProductImage,ProductCategorieId,ProductCategorieName,ArrayOfProductImages,ProductDate,date,ProductPriceBeforeRival){
  setDoc(doc(db,"StoreProducts",id), {
      id: id,
      ProductName: ProductName,
      ProductPriceBeforeRival: ProductPriceBeforeRival||"",
      ProductPrice: ProductPrice,
      ProductNote: ProductNote,
      ProductNote2: ProductNote2,
      ProductCategorieId: ProductCategorieId,
      ProductCategorieName: `${ProductCategorieName}`,
      ProductImage: ProductImage,
      ProductDate: ProductDate||showDate(),
      date: date||Date.now(),
      ArrayOfProductImages: ArrayOfProductImages,
      isHidden: false,
    }).then(e=>{});

};


/* end function to editProduct */










/*  start function to upload img when add new order */


async function uploadImageForAddNewProduct(input,ProductName,ProductPrice,ProductNote,id,ProductImage,ProductCategorieId,ProductCategorieName) {

let ArrayOfProductImagesOld = [];

if(input!=="noNewImg"){

  let ArrayOfProductImages = ArrayOfProductImagesOld||[];
  for(let i=0; i<input.files.length; i++){

    const ref = firebase.storage().ref();
    const file =  input.files[i];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type,
    };
    
    const task = ref.child(name).put(file, metadata);
    await task
    .then(async snapshot => snapshot.ref.getDownloadURL())
    .then(async url => {
    
      ArrayOfProductImages.push({src: url});
      
    })
    .catch(console.error);
    
    };

    Swal.fire("Done","","success");
    AddNewProduct(ProductName,ProductPrice,ProductNote,id, ArrayOfProductImages[0].src,ProductCategorieId,ProductCategorieName,ArrayOfProductImages);
  };


};


/* end function to upload img when add new order  */















/*  start function to upload img */


async function uploadImageForEditProduct(input,ProductName,ProductPrice,ProductNote,ProductNote2,id,ProductImage,ProductCategorieId,ProductCategorieName,ProductDate,date,ArrayOfProductImagesOld,ProductPriceBeforeRival) {

console.log(ArrayOfProductImagesOld);

if(input!=="noNewImg"){

  let ArrayOfProductImages = ArrayOfProductImagesOld||[];
  for(let i=0; i<input.files.length; i++){

    const ref = firebase.storage().ref();
    const file =  input.files[i];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type,
    };
    
    const task = ref.child(name).put(file, metadata);
    await task
    .then(async snapshot => snapshot.ref.getDownloadURL())
    .then(async url => {
    
      ArrayOfProductImages.push({src: url});
      
    })
    .catch(console.error);
    
    };

    Swal.fire("Done","","success");
    editProduct(ProductName,ProductPrice,ProductNote,ProductNote2,id, ArrayOfProductImages[0].src,ProductCategorieId,ProductCategorieName,ArrayOfProductImages,ProductDate,date,ProductPriceBeforeRival);
  };


};


/* end function to upload img */








/* 1 start function to get data now */
function showDate(){
  
  const d = new Date();
  
  let year = d.getFullYear();
  let month = d.getMonth();
  let day = d.getDate();
  let hour = d.getHours();
  let mint = d.getMinutes();
  
  if(mint<10){
    mint=`0${mint}`
  }
  
  let dateNow;

  // console.log(hour)

  if (hour>=12){
    
    dateNow= `
      ${year}/${month+1}/${day}
      => ${hour-12}:${mint} PM
      `;

  } else if (hour<=11){
    
      dateNow = `
      
      ${year}/${month+1}/${day}
         ${hour}:${mint} AM
      
      `;
  }
  return dateNow;
}

/* 1 end function to get data now */


































/* start add new bannar */

document.querySelector(".BannarBtn").addEventListener("click",()=>{


Swal.fire({
    title: ' تعديل صور البانر ',
    html: `
    
    
    <div class="mainForm" style="overflow-y: hidden; overflow-c: scroll; font-size: 17px!important; font-family: 'Cairo', sans-serif; font-weight: bold!important;">

      <label for="BannarNumber">رقم البانر</label>

      <select style="width: 98%;" class="addOrderInput" id="BannarNumber" dir="auto">
        <option value="Bannar1">الاول</option>
        <option value="Bannar2">الثاني</option>
        <option value="Bannar3">الثالث</option>
      </select>


      <label for="BannarLink">لينك العرض</label>
      <input style="width: 98%;" class="addOrderInput" type="text" dir="rtl" autocomplete="off" id="BannarLink">

      <br><br>
      <label for="BannerImgInput" class="ProductImgLabel" style="border: none;border-radius: 20px;background: green;color: white;padding: 5px 15px;cursor: pointer;">اختر صورة البنر</label>
      <input style="width: 98%; display: none;" class="addOrderInput" accept="image/*" type="file" dir="rtl" autocomplete="off" id="BannerImgInput" >

      <br><br>

      <img src="" style="display: none; width: 100%; max-height: 200px;" class="ProductImgUpload">


    </div>

    `,
    confirmButtonText: 'حفظ',
}).then(async (result) => {    
    if (result.isConfirmed) {

        let BannarNumber=document.querySelector("#BannarNumber").value;
        let BannarLink=document.querySelector("#BannarLink").value;
        let BannerImgInput = document.querySelector("#BannerImgInput");
        let id = `${BannarNumber}`;


        if(BannarNumber.trim()!==''&&BannarLink.trim()!==''){


          Swal.fire({
              title: 'Please Wait!',
              didOpen: () => {
                Swal.showLoading()
              }
          });
          
          const ref = firebase.storage().ref();
          const file =  BannerImgInput.files[0];
          const name = +new Date() + "-" + file.name;
          const metadata = {
            contentType: file.type,
          };
          
          const task = ref.child(name).put(file, metadata);
          task
          .then(async snapshot => snapshot.ref.getDownloadURL())
          .then(async url => {
          
            console.log(url)

            setDoc(doc(db,"Bannar",`${id}`),{
              BannarImg: url,
              BannarLink: BannarLink,
            }).then(e=>{
              Swal.fire(' تم التعديل ', '', 'success');
            })
            
          });

        } else{
          Swal.fire(' برجاء كتابة لينك البانر واختيار الصوره', '', 'error');
        }

    };
});

});


/* end add new bannar */











/* start Store Categories Btn */


document.querySelector(".StoreCategoriesBtn").addEventListener("click",()=>{
  ShowAllStoreCategories();
});



async function getAllStoreCategories(){
  const q = query(collection(db, "StoreCategories"), orderBy("date","desc"));
  const querySnapshot = await getDocs(q);
  const cityList = querySnapshot.docs.map(doc => doc.data());

  return cityList;
};



async function ShowAllStoreCategories() {

  let AllStoreCategories;
  await getAllStoreCategories().then(e=>{
    AllStoreCategories=e;
  });


  let newSelect = document.createElement("select");
  AllStoreCategories.forEach(e=>{

    newSelect.innerHTML+=`
    <option value="${e.id}">${e.name}</option>
    `;

  });


  Swal.fire({
      title: ' اقسام المتجر ',
      html: `
      
      <div class="mainForm" style="overflow-y: hidden; overflow-c: scroll; font-size: 17px!important; font-family: 'Cairo', sans-serif; font-weight: bold!important;">

        <label for="AllCategories">جميع الاقسام</label>
        <select style="width: 98%;" class="addOrderInput" id="AllCategories" dir="auto">
          ${newSelect.innerHTML}
        </select>
        <br>
        <button style="font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: darkred; color: white; padding: 5px 0px; font-weight: 600; border: none;" class="RemoveCategorie">حذف قسم</button>
        <button style="font-size: 18px; font-family:cairo; cursor:pointer; width: 120px; margin: 20px; border-radius: 10px; background: green; color: white; padding: 5px 0px; font-weight: 600; border: none;" class="AddNewCategorie">اضافة قسم</button>

      </div>

      `,
      showConfirmButton: false
  });

};


/* end Store Categories Btn */







/* start function to add new Categories  */

async function AddNewCategorie(){
  let { value: name } = await Swal.fire({
    input: 'text',
    title: 'اسم القسم',
    confirmButtonText: 'ok'
  })

  if(name){
    let id = (Math.random()*100000000).toFixed();

    setDoc(doc(db,"StoreCategories",`${id}`),{
      id: id,
      name: name,
      date: Date.now(),
    }).then(
      Swal.fire(
        'Good!',
        'تم اضافة القسم',
        'success'
      )
    );
    
  };
};


/* end function to add new Categories  */







/* start function to delete Categories  */

async function DeleteCategorie(){

  let CategorieSelect = document.querySelector("#AllCategories");
  let CategorieNeedToRemove = CategorieSelect.value.trim();
  let CategorieNeedToRemoveName = CategorieSelect.options[CategorieSelect.selectedIndex].text;
  let CategorieDoc=doc(db, "StoreCategories", `${CategorieNeedToRemove}`);

  Swal.fire({
    title: "هل تريد حذف هذا القسم؟",
    html: `<h2>${CategorieNeedToRemoveName}</h2>`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
    if(result.isConfirmed) {

      deleteDoc(CategorieDoc).then(e=>{

        Swal.fire(
          'Deleted!',
          'Categorie has been deleted.',
          'success'
        );

      })
    };
  });

};


/* end function to delete Categories  */














/* 2 start function to get differnce between data now */
function getDiffDate(oldDate){
        
    var starts = moment(`${oldDate}`);
    var ends   = moment();

    var duration = moment.duration(ends.diff(starts));

    // with ###moment precise date range plugin###
    // it will tell you the difference in human terms

    var diff = moment.preciseDiff(starts, ends, true); 
    // example: { "years": 2, "months": 7, "days": 0, "hours": 6, "minutes": 29, "seconds": 17, "firstDateWasLater":  false }


    // or as string:
    var diffHuman = moment.preciseDiff(starts, ends);
    // example: 2 years 7 months 6 hours 29 minutes 17 seconds

    let diffDate=diff;

    if(diffDate.years!==0){
        diffDate={
            "diffDateNum": diffDate.years,
            "diffDateName": "سنة",
        };
    } else if(diff.months!==0){
        diffDate={
            "diffDateNum": diffDate.months,
            "diffDateName": "شهر",
        };
    } else if(diff.days!==0){
        diffDate={
            "diffDateNum": diffDate.days,
            "diffDateName": "يوم",
        };
    } else if(diff.hours!==0){
        diffDate={
            "diffDateNum": diffDate.hours,
            "diffDateName": "ساعة",
        };
    } else if(diff.minutes!==0){
        diffDate={
            "diffDateNum": diffDate.minutes,
            "diffDateName": "دقيقة",
        };
    } else {
        diffDate={
            "diffDateNum": 0,
            "diffDateName": "الان",
        };
    }

    let stringDiffDate = `منذ ${diffDate.diffDateNum + " " + diffDate.diffDateName}`;
    // منذ 1 سنة

    if(diffDate.diffDateName=="الان"){
      stringDiffDate="الان";
    }
    
    // diffDate => json like {diffDateNum: 1, diffDateName: 'سنة'}

    return stringDiffDate;
}

// console.log(getDiffDate("2022/1/1 => 5:55 PM"));

/* 2 end function to get differnce between data now */



</script>


</html>
